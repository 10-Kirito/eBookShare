"use strict";(self["webpackChunkfrontdesk"]=self["webpackChunkfrontdesk"]||[]).push([[718],{4718:function(e,o,t){t.r(o),t.d(o,{default:function(){return p}});var a=function(){var e=this,o=e._self._c;return o("div",[o("el-card",{staticStyle:{width:"500px",margin:"50px auto auto"}},[o("el-form",{attrs:{"label-width":"80px",size:"small"}},[o("el-form-item",{attrs:{label:"书名"}},[o("el-input",{attrs:{type:"textarea",rows:"1",autocomplete:"off",placeholder:"请输入书籍名称"},model:{value:e.form.bookname,callback:function(o){e.$set(e.form,"bookname",o)},expression:"form.bookname"}})],1),o("el-form-item",{attrs:{label:"作者"}},[o("el-input",{attrs:{type:"textarea",rows:"1",autocomplete:"off",placeholder:"请输入作者"},model:{value:e.form.author,callback:function(o){e.$set(e.form,"author",o)},expression:"form.author"}})],1),o("el-form-item",{attrs:{label:"出版社"}},[o("el-input",{attrs:{type:"textarea",rows:"1",autocomplete:"off",placeholder:"请输入出版社"},model:{value:e.form.publisher,callback:function(o){e.$set(e.form,"publisher",o)},expression:"form.publisher"}})],1),o("el-form-item",{attrs:{label:"isbn"}},[o("el-input",{attrs:{type:"textarea",rows:"1",autocomplete:"off",placeholder:"请输入书籍isbn"},model:{value:e.form.isbn,callback:function(o){e.$set(e.form,"isbn",o)},expression:"form.isbn"}})],1),o("el-form-item",{attrs:{label:"简介"}},[o("el-input",{attrs:{type:"textarea",rows:"6",autocomplete:"off",placeholder:"请输入简介"},model:{value:e.form.description,callback:function(o){e.$set(e.form,"description",o)},expression:"form.description"}})],1),o("el-form-item",{attrs:{label:"分类"}},[o("el-input",{attrs:{type:"textarea",rows:"1",autocomplete:"off",placeholder:"请输入分类"},model:{value:e.form.category,callback:function(o){e.$set(e.form,"category",o)},expression:"form.category"}})],1),o("el-upload",{ref:"uploadpic",staticClass:"avatar-uploader",staticStyle:{"text-align":"center"},attrs:{action:"http://124.71.166.37:9091/auditbooks/uploadpic","show-file-list":!1,"auto-upload":!1,"on-success":e.addBookInfo,"on-change":e.handlePictureCardPreview}},[e.form.avatarurl?o("img",{staticClass:"avatar",attrs:{src:e.form.avatarurl}}):o("i",{staticClass:"el-icon-plus avatar-uploader-icon",staticStyle:{border:"1px dashed seagreen"}}),o("el-dialog",{attrs:{visible:e.dialogVisible,"append-to-body":""},on:{"update:visible":function(o){e.dialogVisible=o}}},[o("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1),o("el-form-item",{staticStyle:{"margin-left":"-140px"}},[o("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{type:"file",data:e.uploadData,name:"file",action:"http://124.71.166.37:9091/auditbooks/upload",limit:1,"auto-upload":!1,"on-change":e.loadJsonFromFile,"on-success":e.uploadPicFile,"on-error":e.uploadError,"before-upload":e.beforeUpload,"before-remove":e.beforeRemove},scopedSlots:e._u([{key:"trigger",fn:function(){return[o("el-button",{staticStyle:{margin:"20px 60px auto"},attrs:{type:"primary"}},[e._v("选择")])]},proxy:!0},{key:"tip",fn:function(){},proxy:!0}])},[o("el-button",{staticStyle:{"margin-left":"5px","margin-bottom":"20px"},attrs:{type:"success"},on:{click:e.uploadBookFile}},[e._v(" 确定 ")])],1)],1)],1)],1)],1)},r=[],l={inject:["reload"],name:"UploadBook",data(){return{form:{},file:"",uploadFiles:[],uploadData:{},dialogVisible:!1,dialogImageUrl:"",queryParams:"",user:localStorage.getItem("loguserinfo")?JSON.parse(localStorage.getItem("loguserinfo")):{}}},methods:{addBookInfo(e){let o=this.uploadFiles[0];console.log(o.name),console.log(this.form);var t=encodeURIComponent(o.name),a=encodeURIComponent(this.form.bookname),r=encodeURIComponent(this.form.author),l=encodeURIComponent(this.form.publisher),s=encodeURIComponent(this.form.isbn),i=encodeURIComponent(this.form.description),n=encodeURIComponent(this.form.category);this.request.get("/auditbooks/addbookinfo",{params:{filename:t,bookname:a,author:r,publisher:l,isbn:s,description:i,category:n}}).then((e=>{"200"===e.code?this.$message.success("上传成功"):this.$message.error("上传失败")})),this.reload()},handlePictureCardPreview(e){this.dialogVisible=!0,e.url||(e.url=URL.createObjectURL(e.raw)),this.dialogImageUrl=e.url,this.form.avatarurl=e.url},loadJsonFromFile(e,o){this.uploadFiles=o;var t=e.name.replace(/.+\./,"");const a=e.size/1024/1024<100;var r=-1===["pdf","epub"].indexOf(t.toLowerCase());return r?(this.$message({type:"warning",message:"只能上传 PDF  EPUB 文件"}),!1):a?void 0:(this.$message({type:"warning",message:"附件大小超限，文件不能超过 100M"}),!1)},uploadPicFile(e){console.log(e),this.$refs.uploadpic.submit()},uploadError(){this.$message.error("文件上传失败")},beforeUpload(e){this.uploadData.userid=this.user.id,console.log("文件：",e);var o=e.name.replace(/.+\./,"");const t=e.size/1024/1024<100;var a=-1===["pdf","epub"].indexOf(o.toLowerCase());return a?(this.$message({type:"warning",message:"只能上传 PDF  EPUB 文件"}),!1):t?void 0:(this.$message({type:"warning",message:"附件大小超限，文件不能超过 100M"}),!1)},beforeRemove(e,o){var t=e.name.replace(/.+\./,""),a=e.size/1024/1024<100,r=-1===["pdf","epub"].indexOf(t.toLowerCase());if(r&&a)return this.$confirm(`确定移除 ${e.name}？`);var l=o.indexOf(e);return o.splice(l,1),!1},uploadBookFile(){this.$refs.upload.submit()}}},s=l,i=t(3736),n=(0,i.Z)(s,a,r,!1,null,"23283e10",null),p=n.exports}}]);
//# sourceMappingURL=718.4537043c.js.map