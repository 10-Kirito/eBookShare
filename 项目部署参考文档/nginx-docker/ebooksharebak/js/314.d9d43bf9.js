"use strict";(self["webpackChunkdb_peoject_bs"]=self["webpackChunkdb_peoject_bs"]||[]).push([[314,305],{4314:function(e,t,o){o.r(t),o.d(t,{default:function(){return u}});var a=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticStyle:{margin:"10px 0"}},[t("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入ISBN","suffix-icon":"el-icon-search"},model:{value:e.isbn,callback:function(t){e.isbn=t},expression:"isbn"}}),t("el-input",{staticClass:"ml-5",staticStyle:{width:"200px"},attrs:{placeholder:"请输入书籍名称","suffix-icon":"el-icon-message"},model:{value:e.bookname,callback:function(t){e.bookname=t},expression:"bookname"}}),t("el-input",{staticClass:"ml-5",staticStyle:{width:"200px"},attrs:{placeholder:"请输入作者","suffix-icon":"el-icon-message"},model:{value:e.author,callback:function(t){e.author=t},expression:"author"}}),t("el-input",{staticClass:"ml-5",staticStyle:{width:"200px"},attrs:{placeholder:"请输入出版社","suffix-icon":"el-icon-message"},model:{value:e.publisher,callback:function(t){e.publisher=t},expression:"publisher"}}),t("el-button",{staticClass:"ml-5",attrs:{type:"primary"},on:{click:e.load}},[e._v("搜索")]),t("el-button",{attrs:{type:"warning"},on:{click:e.reset}},[e._v("重置")])],1),t("div",{staticStyle:{margin:"10px 0"}},[t("el-button",{staticClass:"ml-5",attrs:{type:"primary"},on:{click:e.exp}},[e._v("导出"),t("i",{staticClass:"el-icon-top"})])],1),t("el-table",{attrs:{data:e.tableData,border:"",stripe:"","header-cell-class-name":"headerBg"},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{prop:"isbn",label:"ISBN",width:"150"}}),t("el-table-column",{attrs:{prop:"bookname",label:"书籍名称",width:"150"}}),t("el-table-column",{attrs:{prop:"author",label:"作者"}}),t("el-table-column",{attrs:{prop:"publisher",label:"出版社"}}),t("el-table-column",{attrs:{prop:"category",label:"类别"}}),t("el-table-column",{attrs:{prop:"releasetime",label:"上传时间"}}),t("el-table-column",{attrs:{label:"操作",width:"330"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.preview(o.row)}}},[e._v("预览"),t("i",{staticClass:"el-icon-edit"})]),t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.handleEdit(o.row)}}},[e._v("编辑"),t("i",{staticClass:"el-icon-edit"})]),t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.Pass(o.row.bookid)}}},[e._v("通过"),t("i",{staticClass:"el-icon-edit"})]),t("el-popconfirm",{staticClass:"ml-7",attrs:{"confirm-button-text":"确认","cancel-button-text":"取消",icon:"el-icon-info","icon-color":"red",title:"是否撤回?"},on:{confirm:function(t){return e.cancelbooks(o.row.bookid)}},scopedSlots:e._u([{key:"reference",fn:function(){return[t("el-button",{attrs:{type:"danger"}},[e._v("撤回"),t("i",{staticClass:"el-icon-remove-outline"})])]},proxy:!0}],null,!0)})]}}])})],1),t("div",{staticStyle:{padding:"10px 0"}},[t("el-pagination",{attrs:{"current-page":e.pageNum,"page-sizes":[2,5,10,20],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:"书籍信息",visible:e.dialogFormVisible,width:"30%"},on:{"update:visible":function(t){e.dialogFormVisible=t}},scopedSlots:e._u([{key:"footer",fn:function(){return[t("span",{staticClass:"dialog-footer"},[t("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v(" 确认 ")])],1)]},proxy:!0}])},[t("el-form",{attrs:{"label-width":"80px",size:"small"}},[t("el-form-item",{attrs:{label:"ISBN"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.isbn,callback:function(t){e.$set(e.form,"isbn",t)},expression:"form.isbn"}})],1),t("el-form-item",{attrs:{label:"书籍名称"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.bookname,callback:function(t){e.$set(e.form,"bookname",t)},expression:"form.bookname"}})],1),t("el-form-item",{attrs:{label:"作者"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.author,callback:function(t){e.$set(e.form,"author",t)},expression:"form.author"}})],1),t("el-form-item",{attrs:{label:"出版社"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.publisher,callback:function(t){e.$set(e.form,"publisher",t)},expression:"form.publisher"}})],1),t("el-form-item",{attrs:{label:"类别"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}})],1)],1)],1),t("el-dialog",{attrs:{title:"撤回通知",visible:e.cancel,width:"30%"},on:{"update:visible":function(t){e.cancel=t}},scopedSlots:e._u([{key:"footer",fn:function(){return[t("span",{staticClass:"dialog-footer"},[t("el-button",{on:{click:function(t){e.cancel=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.cancelOperation}},[e._v(" 确认 ")])],1)]},proxy:!0}])},[t("el-form",{attrs:{"label-width":"80px",size:"small"}},[t("el-form-item",{attrs:{label:"原因"}},[t("el-input",{attrs:{type:"textarea",rows:"6",autocomplete:"off",placeholder:"请输入撤回原因"},model:{value:e.suggestions,callback:function(t){e.suggestions=t},expression:"suggestions"}})],1)],1)],1)],1)},s=[],l=(o(7658),o(4305)),i={inject:["reload"],name:"User",computed:{EBookUpload(){return l["default"]}},data(){return{tableData:[],total:0,pageNum:1,pageSize:10,id:"",bookname:"",author:"",publisher:"",isbn:"",currentsize:"",suggestions:"",dialogFormVisible:!1,cancel:!1,multipleSelection:[],form:{},bookid:"",headerBg:"headerBg"}},created(){this.load()},methods:{load(){this.request.get("/auditbooks/page",{params:{pageNum:this.pageNum,pageSize:this.pageSize,bookname:this.bookname,author:this.author,publisher:this.publisher,isbn:this.isbn}}).then((e=>{console.log(e),this.tableData=e.records,this.total=e.total}))},save(){this.request.post("/auditbooks/save",this.form).then((e=>{e?(this.$message.success("保存成功"),this.dialogFormVisible=!1,this.load()):this.$message.error("保存失败")}))},handleEdit(e){this.form=e,this.dialogFormVisible=!0},preview(e){console.log(e);let t=e.url;window.open(`/lib/pdfjs-3.5.141-dist/web/viewer.html?file=${t}`)},Pass(e){this.request.post("/auditbooks/move/"+e).then((e=>{console.log(e),"SUCCESS"==e.code?(this.$message.success(e.msg),this.reload()):this.$message.error(e.msg)}))},handleAdd(){this.dialogFormVisible=!0,this.form={}},handleSelectionChange(e){console.log(e),this.multipleSelection=e},EBookup(){this.$router.push("/admins/ebookupload")},reset(){this.lnumber="",this.lname="",this.lcredit="",this.lcollege="",this.load()},handleSizeChange(e){this.pageSize=e,this.load()},handleCurrentChange(e){this.pageNum=e,this.load()},exp(){window.open("http://124.71.166.37:9091/auditbooks/export")},cancelbooks(e){this.cancel=!0,this.bookid=e},cancelOperation(){this.request.delete("/auditbooks/cancel",{params:{bookid:this.bookid,suggestions:this.suggestions}}).then((e=>{"200"===e.code?(this.$message.success("撤回成功"),this.load(),this.cancel=!1):this.$message.error("撤回失败")}))},handleExcelImportSuccess(){this.$message.success("文件上传成功！"),this.load(),this.cancel=!1}}},r=i,n=o(1001),c=(0,n.Z)(r,a,s,!1,null,null,null),u=c.exports},4305:function(e,t,o){o.r(t),o.d(t,{default:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("div",[t("el-card",{staticStyle:{width:"500px",margin:"50px auto auto"}},[t("el-form",{attrs:{"label-width":"80px",size:"small"}},[t("el-form-item",{attrs:{label:"书名"}},[t("el-input",{attrs:{type:"textarea",rows:"1",autocomplete:"off",placeholder:"请输入书籍名称"},model:{value:e.form.bookname,callback:function(t){e.$set(e.form,"bookname",t)},expression:"form.bookname"}})],1),t("el-form-item",{attrs:{label:"作者"}},[t("el-input",{attrs:{type:"textarea",rows:"1",autocomplete:"off",placeholder:"请输入作者"},model:{value:e.form.author,callback:function(t){e.$set(e.form,"author",t)},expression:"form.author"}})],1),t("el-form-item",{attrs:{label:"出版社"}},[t("el-input",{attrs:{type:"textarea",rows:"1",autocomplete:"off",placeholder:"请输入出版社"},model:{value:e.form.publisher,callback:function(t){e.$set(e.form,"publisher",t)},expression:"form.publisher"}})],1),t("el-form-item",{attrs:{label:"isbn"}},[t("el-input",{attrs:{type:"textarea",rows:"1",autocomplete:"off",placeholder:"请输入书籍isbn"},model:{value:e.form.isbn,callback:function(t){e.$set(e.form,"isbn",t)},expression:"form.isbn"}})],1),t("el-form-item",{attrs:{label:"简介"}},[t("el-input",{attrs:{type:"textarea",rows:"6",autocomplete:"off",placeholder:"请输入简介"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),t("el-form-item",{attrs:{label:"分类"}},[t("el-input",{attrs:{type:"textarea",rows:"1",autocomplete:"off",placeholder:"请输入分类"},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}})],1),t("el-upload",{ref:"uploadpic",staticClass:"avatar-uploader",staticStyle:{"text-align":"center"},attrs:{action:"http://124.71.166.37:9091/books/uploadpic","show-file-list":!1,"auto-upload":!1,"on-success":e.addBookInfo,"on-change":e.handlePictureCardPreview}},[e.form.avatarurl?t("img",{staticClass:"avatar",attrs:{src:e.form.avatarurl}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"}),t("el-dialog",{attrs:{visible:e.dialogVisible,"append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1),t("el-form-item",[t("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{type:"file",data:e.uploadData,name:"file",action:"http://124.71.166.37:9091/books/upload",limit:1,"auto-upload":!1,"on-change":e.loadJsonFromFile,"on-success":e.uploadPicFile,"on-error":e.uploadError,"before-upload":e.beforeUpload,"before-remove":e.beforeRemove},scopedSlots:e._u([{key:"trigger",fn:function(){return[t("el-button",{staticClass:"ml-5",staticStyle:{margin:"20px 60px auto"},attrs:{type:"primary"}},[e._v("选择")])]},proxy:!0},{key:"tip",fn:function(){},proxy:!0}])},[t("el-button",{staticClass:"ml-5",staticStyle:{"margin-bottom":"20px"},attrs:{type:"success"},on:{click:e.uploadBookFile}},[e._v(" 确定 ")])],1)],1)],1)],1)],1)},s=[],l={name:"Person",data(){return{form:{},file:"",uploadFiles:[],uploadData:{},dialogVisible:!1,dialogImageUrl:"",queryParams:"",user:localStorage.getItem("loguserinfo")?JSON.parse(localStorage.getItem("loguserinfo")):{}}},methods:{btKeyUp(){this.form.bookname=this.form.bookname.replace(/[^\w\u4E00-\u9FA5]/g,"")},handlePictureCardPreview(e){this.dialogVisible=!0,e.url||(e.url=URL.createObjectURL(e.raw)),this.dialogImageUrl=e.url,this.form.avatarurl=e.url},loadJsonFromFile(e,t){this.uploadFiles=t;var o=e.name.replace(/.+\./,"");const a=e.size/1024/1024<100;var s=-1===["pdf","epub"].indexOf(o.toLowerCase());return s?(this.$message({type:"warning",message:"只能上传 PDF  EPUB 文件"}),!1):a?void 0:(this.$message({type:"warning",message:"附件大小超限，文件不能超过 100M"}),!1)},beforeUpload(e){console.log("文件：",e);var t=e.name.replace(/.+\./,"");const o=e.size/1024/1024<100;var a=-1===["pdf","epub"].indexOf(t.toLowerCase());return a?(this.$message({type:"warning",message:"只能上传 PDF  EPUB 文件"}),!1):o?void 0:(this.$message({type:"warning",message:"附件大小超限，文件不能超过 100M"}),!1)},beforeRemove(e,t){var o=e.name.replace(/.+\./,""),a=e.size/1024/1024<100,s=-1===["pdf","epub"].indexOf(o.toLowerCase());if(s&&a)return this.$confirm(`确定移除 ${e.name}？`);var l=t.indexOf(e);return t.splice(l,1),!1},updatebookpic(e){console.log(e),this.$message.success(e.msg)},uploadError(){this.$message.error("文件上传失败")},uploadBookFile(){this.$refs.upload.submit()},uploadPicFile(e){console.log(e),this.$refs.uploadpic.submit()},addBookInfo(e){let t=this.uploadFiles[0];this.$message.error("获取信息："+t.name),console.log(t.name),console.log(this.form);var o=encodeURIComponent(t.name),a=encodeURIComponent(this.form.bookname),s=encodeURIComponent(this.form.author),l=encodeURIComponent(this.form.publisher),i=encodeURIComponent(this.form.isbn),r=encodeURIComponent(this.form.description),n=encodeURIComponent(this.form.category);this.request.get("/books/addbookinfo",{params:{filename:o,bookname:a,author:s,publisher:l,isbn:i,description:r,category:n}}).then((e=>{"200"===e.code?this.$message.success("上传成功"):this.$message.error("上传失败")}))},handleAvatarSuccess(e){this.form.avatarurl=e},picChange(e){e.url||(e.url=URL.createObjectURL(e.raw)),this.$message.error("图片预览url"+e.url),console.log(e),this.form.avatarurl=e.uid}}},i=l,r=o(1001),n=(0,r.Z)(i,a,s,!1,null,null,null),c=n.exports}}]);
//# sourceMappingURL=314.d9d43bf9.js.map